<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Carte Continue</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
        }
        button:active {
            background: #2980b9;
        }
        #console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #f59e0b; }
        #storage-data {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Carte "Continue"</h1>
    
    <div class="test-box">
        <h2>√âtape 1: Cr√©er des donn√©es de test</h2>
        <button onclick="createTestData()">‚úÖ Cr√©er Progress Test</button>
        <p id="create-status"></p>
    </div>

    <div class="test-box">
        <h2>√âtape 2: V√©rifier localStorage</h2>
        <button onclick="checkStorage()">üîç V√©rifier localStorage</button>
        <div id="storage-data"></div>
    </div>

    <div class="test-box">
        <h2>√âtape 3: Tester loadGameProgress()</h2>
        <button onclick="testLoadProgress()">üìÇ Charger Progress</button>
        <p id="load-status"></p>
    </div>

    <div class="test-box">
        <h2>√âtape 4: Rafra√Æchir et voir si "Continue" appara√Æt</h2>
        <button onclick="window.location.href='index.html'">üéÆ Ouvrir le Jeu</button>
        <p><small>La carte "üìç Continue" devrait appara√Ætre en premier dans la s√©lection de niveau</small></p>
    </div>

    <div class="test-box">
        <h2>üìã Console de Debug:</h2>
        <div id="console-output">Pr√™t...</div>
    </div>

    <script>
        const consoleOutput = document.getElementById('console-output');
        
        function addLog(msg) {
            consoleOutput.innerHTML += msg + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(msg);
        }

        function createTestData() {
            addLog('=== CR√âATION DE DONN√âES TEST ===');
            
            // Create test progress that completed level_1
            const testProgress = {
                userName: 'Demo User',
                currentLevel: 'level_1',
                hp: 100,
                elapsedTime: 120,
                timestamp: Date.now()
            };
            
            try {
                // Save to both keys
                localStorage.setItem('gameProgress_Demo User', JSON.stringify(testProgress));
                localStorage.setItem('gameProgress', JSON.stringify(testProgress));
                
                addLog('‚úÖ Donn√©es sauvegard√©es:');
                addLog(JSON.stringify(testProgress, null, 2));
                
                document.getElementById('create-status').innerHTML = 
                    '<span style="color: green;">‚úÖ Donn√©es cr√©√©es avec succ√®s!</span>';
            } catch (error) {
                addLog('‚ùå Erreur: ' + error.message);
                document.getElementById('create-status').innerHTML = 
                    '<span style="color: red;">‚ùå √âchec: ' + error.message + '</span>';
            }
        }

        function checkStorage() {
            addLog('=== V√âRIFICATION LOCALSTORAGE ===');
            const storageDiv = document.getElementById('storage-data');
            let html = '';
            
            const keys = ['gameProgress', 'gameProgress_Demo User'];
            keys.forEach(key => {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        html += `<strong style="color: green;">‚úÖ ${key}:</strong><br>`;
                        html += `<pre>${JSON.stringify(parsed, null, 2)}</pre><br>`;
                        addLog(`‚úÖ Trouv√©: ${key}`);
                    } catch (e) {
                        html += `<strong style="color: red;">‚ùå ${key}: Erreur parsing</strong><br>`;
                        addLog(`‚ùå Erreur parsing: ${key}`);
                    }
                } else {
                    html += `<strong style="color: orange;">‚ö†Ô∏è ${key}: NON TROUV√â</strong><br>`;
                    addLog(`‚ö†Ô∏è Non trouv√©: ${key}`);
                }
            });
            
            storageDiv.innerHTML = html || 'Aucune donn√©e trouv√©e';
        }

        function testLoadProgress() {
            addLog('=== TEST LOADGAMEPROGRESS() ===');
            
            // Simulate having a user
            window.currentUser = { name: 'Demo User' };
            addLog('currentUser d√©fini: Demo User');
            
            // Test loading
            const userKey = 'gameProgress_Demo User';
            const userData = localStorage.getItem(userKey);
            
            if (userData) {
                try {
                    const progress = JSON.parse(userData);
                    addLog('‚úÖ Progress charg√©:');
                    addLog(JSON.stringify(progress, null, 2));
                    addLog('');
                    addLog('üìç Si currentLevel = "level_1"');
                    addLog('üìç Alors Continue = "level_2"');
                    addLog('');
                    
                    if (progress.currentLevel) {
                        document.getElementById('load-status').innerHTML = 
                            `<span style="color: green;">‚úÖ Progress trouv√©!<br>` +
                            `Niveau compl√©t√©: ${progress.currentLevel}<br>` +
                            `Continue devrait montrer: le niveau suivant</span>`;
                    } else {
                        document.getElementById('load-status').innerHTML = 
                            '<span style="color: orange;">‚ö†Ô∏è Progress trouv√© mais currentLevel est null</span>';
                    }
                } catch (e) {
                    addLog('‚ùå Erreur parsing: ' + e.message);
                    document.getElementById('load-status').innerHTML = 
                        '<span style="color: red;">‚ùå Erreur parsing JSON</span>';
                }
            } else {
                addLog('‚ùå Aucune donn√©e trouv√©e');
                document.getElementById('load-status').innerHTML = 
                    '<span style="color: red;">‚ùå Aucune donn√©e trouv√©e</span>';
            }
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            addLog('Page charg√©e');
            addLog('localStorage disponible: ' + (typeof localStorage !== 'undefined' ? 'OUI' : 'NON'));
            addLog('');
        });
    </script>
</body>
</html>
